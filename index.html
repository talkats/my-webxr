<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floating Model Viewer</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { width: 100%; height: 100%; display: block; }
        #status {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-family: Arial, sans-serif;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="status">Initializing!</div>
    <canvas id="renderCanvas"></canvas>

    <!-- Babylon.js Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@babylonjs/core@6.20.0/babylon.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babylonjs/loaders@6.20.0/babylon.glTF2FileLoader.js"></script>

    <!-- Floating Model Viewer -->
    <script>
        class FloatingModelViewer {
            constructor() {
                console.log("Initializing FloatingModelViewer...");
                this.canvas = document.getElementById("renderCanvas");
                this.engine = new BABYLON.Engine(this.canvas, true);
                this.scene = new BABYLON.Scene(this.engine);
                this.currentModel = null;
                this.isModelGrabbed = false;
                this.init();
            }

            async init() {
                try {
                    console.log("Setting up camera...");
                    this.camera = new BABYLON.FreeCamera("camera", new BABYLON.Vector3(0, 1.6, -0.5), this.scene);
                    this.camera.attachControl(this.canvas, true);
                    this.camera.setTarget(BABYLON.Vector3.Zero());

                    console.log("Adding lighting...");
                    const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), this.scene);
                    light.intensity = 1.0;

                    console.log("Loading model...");
                    await this.loadModel("https://raw.githubusercontent.com/talkats/my-webxr/d1dc39a858f3cfc80e5bbc309f25cbdac2e47f33/Spheres.glb");
                    console.log("Model loaded successfully.");

                    console.log("Starting render loop...");
                    this.engine.runRenderLoop(() => this.scene.render());
                    console.log("Render loop started.");

                    window.addEventListener("resize", () => this.engine.resize());
                } catch (error) {
                    console.error("Initialization failed:", error);
                }
            }

            async loadModel(url) {
                console.log(`Attempting to load model from: ${url}`);
                try {
                    const result = await BABYLON.SceneLoader.ImportMeshAsync("", url, "", this.scene);
                    this.currentModel = result.meshes[0] || null;

                    if (!this.currentModel) {
                        throw new Error("No meshes found in the model.");
                    }

                    console.log("Model added to scene:", this.currentModel);
                    this.currentModel.position = new BABYLON.Vector3(0, 1.6, -0.5);
                } catch (error) {
                    console.error("Error loading model:", error);
                }
            }
        }

        const statusDiv = document.getElementById('status');
        try {
            new FloatingModelViewer();
            statusDiv.textContent = 'App is running!';
        } catch (error) {
            statusDiv.textContent = 'Error initializing the app.';
            console.error('Initialization error:', error);
        }
    </script>
</body>
</html>
